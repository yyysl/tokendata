# 数据来源和计算方法说明

## 📊 数据来源

### 主要数据源
- **CoinGecko API**（免费版）
  - 实时价格数据（全网加权平均价格）
  - 24小时交易量（全网所有交易所总交易量）
  - 市值排名
  - 价格变化百分比
  - 交易所分布数据

### API限制
- 免费版：每分钟50次请求
- 数据延迟：1-5分钟
- 历史数据：有限

## 🌐 数据覆盖范围

### 交易所覆盖
CoinGecko API覆盖了全球主要加密货币交易所，包括但不限于：

#### 主要交易所
- **Binance**（币安）- 全球最大交易所
- **Coinbase** - 美国主要交易所
- **Kraken** - 老牌交易所
- **KuCoin** - 国际交易所
- **OKX** - 亚洲主要交易所
- **Bybit** - 衍生品交易所
- **Gate.io** - 国际交易所
- **Huobi** - 亚洲交易所
- **Bitfinex** - 欧洲交易所
- **Bitstamp** - 欧洲老牌交易所

#### 数据聚合方式
- **价格数据**：所有交易所的加权平均价格
- **交易量数据**：所有交易所的总交易量
- **市值数据**：基于全网价格计算
- **排名数据**：基于全网市值排名

## 🔢 计算方法

### 1. 成交量计算

#### 24小时成交量
- **数据来源**：CoinGecko API直接提供
- **覆盖范围**：全网所有交易所的总交易量
- **包含交易所**：Binance、Coinbase、Kraken、KuCoin、OKX、Bybit、Gate.io、Huobi、Bitfinex、Bitstamp等
- **计算方式**：所有交易所24小时内的总交易量
- **单位**：美元（USD）

#### 1小时成交量
- **计算方式**：`24小时成交量 ÷ 24`
- **说明**：基于24小时数据的平均估算
- **精度**：中等（假设交易量在24小时内均匀分布）

#### 7天成交量
- **计算方式**：`24小时成交量 × 7`
- **说明**：基于24小时数据的线性外推
- **精度**：较低（未考虑周末效应和周期性变化）

### 2. 资金流向计算

#### 核心公式
```
流向金额 = 全网交易量 × 价格变化比例 × 系数
```

#### 详细计算步骤

1. **价格变化分析**
   - 获取1小时、24小时、7天价格变化百分比
   - 正值表示上涨，负值表示下跌

2. **流入计算**（价格上涨时）
   ```
   流入金额 = 全网交易量 × (价格变化百分比 / 100) × 流入系数
   流入系数 = min(价格变化百分比 / 100, 0.3)  // 最大30%
   ```

3. **流出计算**（价格下跌时）
   ```
   流出金额 = -全网交易量 × (|价格变化百分比| / 100) × 流出系数
   流出系数 = min(|价格变化百分比| / 100, 0.3)  // 最大30%
   ```

4. **平衡状态**（价格无变化）
   ```
   流向金额 = 0
   ```

#### 系数说明
- **最大系数30%**：假设价格变化主要由30%的交易量驱动
- **动态调整**：根据价格变化幅度动态调整系数
- **保守估计**：避免过度估计资金流向

### 3. 数值格式化

#### 大数字格式化
- **十亿级别**：显示为 "B"（如：25.6B）
- **百万级别**：显示为 "M"（如：125.3M）
- **千级别**：显示为 "K"（如：45.2K）
- **小数位数**：最多保留2位小数

#### 百分比格式化
- **正数**：显示为 "+2.5%"
- **负数**：显示为 "-1.8%"
- **零值**：显示为 "0.00%"

#### 货币格式化
- **价格**：显示为 "$45,230.50"
- **成交量**：显示为 "$125.3M"
- **流向**：显示为 "$+25.6M" 或 "$-12.3M"

## ⚠️ 数据限制和注意事项

### 1. 免费API限制
- **数据延迟**：实时数据可能有1-5分钟延迟
- **请求限制**：每分钟最多50次请求
- **历史数据**：免费版历史数据有限
- **精度限制**：部分高级数据不可用

### 2. 计算精度
- **估算值**：1小时和7天成交量为估算值
- **简化模型**：资金流向计算基于简化模型
- **市场假设**：假设市场行为符合基本规律

### 3. 使用建议
- **参考性质**：分析结果仅供参考，不构成投资建议
- **综合判断**：建议结合其他指标和基本面分析
- **风险控制**：注意市场风险和投资风险

## 🔄 数据更新机制

### 自动更新
- **更新频率**：每5分钟自动更新
- **触发条件**：页面刷新或定时器触发
- **错误处理**：API限制时自动重试

### 手动更新
- **刷新按钮**：点击"刷新数据"按钮
- **下拉选择**：调整显示数量
- **实时响应**：立即获取最新数据

## 📈 未来改进计划

### 1. 数据源扩展
- **Glassnode**：链上数据分析
- **Santiment**：社交情绪数据
- **Kaiko**：专业交易数据

### 2. 算法优化
- **机器学习**：基于历史数据训练模型
- **多因子分析**：考虑更多市场因素
- **实时计算**：提高计算精度和速度

### 3. 功能增强
- **历史对比**：与历史数据对比分析
- **预警系统**：异常数据预警
- **预测模型**：趋势预测功能

## 📞 技术支持

如有问题或建议，请参考：
- **项目文档**：README.md
- **使用指南**：WEB_APP_GUIDE.md
- **资金流向分析**：FLOW_ANALYSIS_GUIDE.md
